<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Tower Defense</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0;
            background: #2c3e50; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden; 
        }
        #game-container { 
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
<div id="game-container"></div>
<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600, // 표준 해상도로 복구
    parent: 'game-container',
    backgroundColor: '#34495e',
    scale: {
        mode: Phaser.Scale.FIT, // 화면에 맞춰 크기 조절
        autoCenter: Phaser.Scale.CENTER_BOTH
    },
    physics: { default: 'arcade' },
    scene: { preload: preload, create: create }
};

let game = new Phaser.Game(config);
let points = 520;
let pointText;
let allWords = [];
let buttons = [];
let wordText;

function preload() {
    // 깃허브에서 json을 못 찾는 경우가 있으니 경로 확인 필수
    this.load.json('wordData', 'words.json');
}

function create() {
    allWords = this.cache.json.get('wordData');
    if (!allWords) {
        console.error("단어 데이터를 불러오지 못했습니다.");
        return;
    }

    // 1. 상단 UI (퀴즈 영역)
    this.add.rectangle(400, 100, 800, 200, 0xffe4c4).setOrigin(0.5);

    // 2. 포인트 바 (보라색)
    this.add.rectangle(400, 215, 800, 30, 0x9b59b6).setOrigin(0.5);
    pointText = this.add.text(20, 215, 'Point: ' + points, { 
        fontSize: '20px', fontWeight: 'bold', fill: '#fff' 
    }).setOrigin(0, 0.5);

    // 3. 하단 맵 영역 (초록색)
    this.add.rectangle(400, 415, 800, 370, 0x2ecc71).setOrigin(0.5);
    this.add.text(400, 415, "MAP AREA\nClick to Build Tower (100 pts)", { 
        fontSize: '24px', align: 'center', fill: '#27ae60', alpha: 0.5 
    }).setOrigin(0.5);

    // 4. 단어 표시 박스
    this.add.rectangle(200, 100, 250, 80, 0xffff00).setStrokeStyle(2, 0x000000);
    wordText = this.add.text(200, 100, '', { 
        fontSize: '32px', fontWeight: 'bold', fill: '#000' 
    }).setOrigin(0.5);

    const showNewQuestion = () => {
        let current = Phaser.Math.RND.pick(allWords);
        wordText.setText(current.word);

        buttons.forEach(b => b.destroy());
        buttons = [];

        let distractors = allWords.filter(w => w.meaning !== current.meaning).sort(() => 0.5 - Math.random()).slice(0, 3);
        let options = [current, ...distractors].sort(() => 0.5 - Math.random());

        options.forEach((opt, i) => {
            let x = 550 + (i % 2) * 120;
            let y = 70 + Math.floor(i / 2) * 60;
            
            let btn = this.add.rectangle(x, y, 110, 50, 0xe74c3c).setInteractive({ useHandCursor: true }).setStrokeStyle(2, 0x000000);
            let txt = this.add.text(x, y, opt.meaning, { fontSize: '16px', fill: '#fff', fontWeight: 'bold', wordWrap: { width: 100 } }).setOrigin(0.5);
            
            btn.on('pointerdown', () => {
                if (opt.meaning === current.meaning) {
                    points += 100;
                    pointText.setText('Point: ' + points);
                    showNewQuestion();
                } else {
                    this.cameras.main.shake(100, 0.005);
                }
            });
            buttons.push(btn, txt);
        });
    };

    showNewQuestion();

    // 타워 설치 로직
    this.input.on('pointerdown', (pointer) => {
        // 포인트 바 아래쪽(맵 영역) 클릭 시에만 타워 생성
        if (pointer.y > 230 && points >= 100) {
            points -= 100;
            pointText.setText('Point: ' + points);
            this.add.rectangle(pointer.x, pointer.y, 40, 40, 0x34495e).setStrokeStyle(2, 0xffffff);
        }
    });
}
</script>
</body>
</html>